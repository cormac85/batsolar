library(dplyr)
library(lubridate)

TARRIF_PRICE_ESTIMATE = 0.05
ELECTRICITY_PRICE = 0.2395
VAT_RATE = 0.135
FINAL_ELECTRICITY_PRICE = ELECTRICITY_PRICE * (1 + VAT_RATE)
OLD_PANEL_KWP = 4.5
NEW_PANEL_KWP = 6.5
OLD_BATTERY_CHARGE_RATE = 1.25
NEW_BATTERY_CHARGE_RATE = 2.5
OLD_BATTERY_SIZE = 2.2
NEW_BATTERY_SIZE = 4.4
BATTERY_STARTING_PROPORTION = 0.2
MIN_OLD_BATTERY_CHARGE <- BATTERY_STARTING_PROPORTION * OLD_BATTERY_SIZE
MIN_NEW_BATTERY_CHARGE <- BATTERY_STARTING_PROPORTION * NEW_BATTERY_SIZE
FIRST_BATTERY_COST <- 2000
ADDITIONAL_BATTERY_COST <- 1300


monthly_solar_usage <- dplyr::tribble(
  ~year_month, ~grid_energy_kwh, ~battery_usage, ~generation, ~consumption, ~buy_energy, ~self_use_rate,
  "2020-06", 48.9, 54.8, 358.4, 905.7, 592.6, 0.7586,
  "2020-07", 50.6, 74.9, 394.9, 921.7, 592.7, 0.6751,
  "2020-08", 43.3, 61.8, 314.3, 976.3, 702.4, 0.7168,
  "2020-09", 60.9, 66.1, 332.8, 844.1, 571.1, 0.67,
  "2020-10", 23.8, 47.0, 235.0, 942.8, 731.7, 0.7531,
  "2020-11", 11.2, 26.6, 119.6, 844.5, 736.4, 0.7566,
  "2020-12", 4.50, 9.60, 77.40, 900.0,    NA, 0.8397,
  "2021-01", 12.0, 12.1, 85.00, 760.0, 680.0, 0.753,
  "2021-02", 21.7, 26.7, 157.5, 870.0, 730.0, 0.743,
  "2021-03", 28.5, 44.1, 280.7, 1170, 910.0, 0.799,
  "2021-04", 66.9, 72.0, 471.6, 1120, 720.0, 0.778,
  "2021-05", 68.9, 85.7, 495.4, 1170, 750.0, 0.777,
  "2021-06", 90.4, 79.1, 506.4, 1020, 600.0, 0.715,
  "2021-07", 57.9, 76.5, 479.8, 1100, 670.0, 0.776,
  "2021-08", 58.8, 59.1, 356.9, 1080, 770.0, 0.684,
  "2021-09", 33.9, 45.6, 262.6, 1100, 870.0, 0.676,
  "2021-10", 13.2, 33.2, 214.6, 1300, 1100, 0.797,
  "2021-11", 1.60, 5.80, 121.7, 1710, 1590, 0.943,
  "2021-12", 0.20, 1.60, 55.60, 2030, 1980, 0.964,
  # missing data for half the month of December, guestimated these numbers
) %>%
  tidyr::separate(year_month, c("year", "month"), remove = FALSE) %>%
  mutate(year = as.numeric(year),
         month = as.numeric(month))

intraday_solar_usage <- dplyr::tribble(
  ~solar_date, ~solar_time, ~generation, ~consumption,
  "2021-07-08", "06:25:00", 0.05, 0.91,
  "2021-07-08", "06:40:00", 0.00, 0.51,
  "2021-07-08", "06:55:00", 0.05, 0.46,
  "2021-07-08", "07:05:00", 0.05, 0.58,
  "2021-07-08", "07:20:00", 0.03, 3.67,
  "2021-07-08", "07:40:00", 0.25, 0.78,
  "2021-07-08", "07:50:00", 0.60, 0.63,
  "2021-07-08", "08:05:00", 0.83, 0.68,
  "2021-07-08", "08:20:00", 0.46, 1.19,
  "2021-07-08", "08:45:00", 0.24, 1.85,
  "2021-07-08", "09:00:00", 0.66, 0.87,
  "2021-07-08", "09:10:00", 0.70, 0.86,
  "2021-07-08", "09:25:00", 0.74, 0.71,
  "2021-07-08", "09:45:00", 0.89, 0.88,
  "2021-07-08", "10:00:00", 0.78, 1.21,
  "2021-07-08", "10:15:00", 1.00, 0.75,
  "2021-07-08", "10.25:00", 1.00, 1.04,
  "2021-07-08", "10:40:00", 1.06, 2.99,
  "2021-07-08", "11:00:00", 1.25, 0.79,
  "2021-07-08", "11:15:00", 1.37, 1.06,
  "2021-07-08", "11:30:00", 1.30, 0.63,
  "2021-07-08", "11:40:00", 1.12, 1.70,
  "2021-07-08", "11:55:00", 1.23, 0.48,
  "2021-07-08", "12:10:00", 2.45, 0.49,
  "2021-07-08", "12:30:00", 1.56, 1.27,
  "2021-07-08", "12:40:00", 1.42, 3.36,
  "2021-07-08", "12:50:00", 1.47, 3.64,
  "2021-07-08", "13:00:00", 1.50, 0.44,
  "2021-07-08", "13:20:00", 1.59, 0.51,
  "2021-07-08", "13:30:00", 1.06, 0.70,
  "2021-07-08", "13:40:00", 1.19, 1.24,
  "2021-07-08", "13:50:00", 1.06, 0.89,
  "2021-07-08", "14:00:00", 1.23, 1.13,
  "2021-07-08", "14:10:00", 1.25, 0.74,
  "2021-07-08", "14:20:00", 1.13, 0.41,
  "2021-07-08", "14:40:00", 1.23, 0.41,
  "2021-07-08", "15:00:00", 1.25, 0.47,
  "2021-07-08", "15:20:00", 1.07, 0.47,
  "2021-07-08", "15:35:00", 1.00, 0.70,
  "2021-07-08", "15:45:00", 1.11, 0.35,
  "2021-07-08", "15:55:00", 1.14, 0.47,
  "2021-07-08", "16:05:00", 1.36, 1.02,
  "2021-07-08", "16:15:00", 1.00, 0.48,
  "2021-07-08", "16:25:00", 0.90, 0.80,
  "2021-07-08", "16:35:00", 0.73, 0.49,
  "2021-07-08", "16:50:00", 0.73, 2.41,
  "2021-07-08", "17:00:00", 0.67, 1.38,
  "2021-07-08", "17:10:00", 0.57, 1.22,
  "2021-07-08", "17:20:00", 0.54, 0.57,
  "2021-07-08", "17:30:00", 0.55, 0.99,
  "2021-07-08", "17:40:00", 0.42, 3.45,
  "2021-07-08", "17:50:00", 0.36, 1.00,
  "2021-07-08", "18:00:00", 0.38, 0.40,
  "2021-07-08", "18:15:00", 0.30, 0.97,
  "2021-07-08", "18:35:00", 0.16, 0.65,
  "2021-07-08", "18:55:00", 0.16, 0.63,
  "2021-07-08", "19:05:00", 0.18, 1.41,
  "2021-07-08", "19:40:00", 0.12, 1.34,
  "2021-07-08", "19:50:00", 0.13, 0.89,
  "2021-07-08", "20:10:00", 0.07, 1.30,
  "2021-07-08", "20:20:00", 0.07, 0.78,

  "2021-07-01", "06:25:00", 0.00, 0.86,
  "2021-07-01", "06:35:00", 0.00, 0.28,
  "2021-07-01", "06:45:00", 0.03, 0.66,
  "2021-07-01", "07:00:00", 0.08, 0.83,
  "2021-07-01", "07:15:00", 0.03, 0.95,
  "2021-07-01", "07:25:00", 0.16, 0.71,
  "2021-07-01", "07:50:00", 0.29, 0.43,
  "2021-07-01", "08:10:00", 0.25, 0.57,
  "2021-07-01", "08:25:00", 0.29, 0.81,
  "2021-07-01", "08:45:00", 0.34, 3.49,
  "2021-07-01", "09:05:00", 0.54, 2.79,
  "2021-07-01", "09:15:00", 0.54, 0.65,
  "2021-07-01", "09:30:00", 0.75, 0.80,
  "2021-07-01", "09:50:00", 0.89, 1.17,
  "2021-07-01", "10:05:00", 0.80, 3.45,
  "2021-07-01", "10:15:00", 0.85, 0.75,
  "2021-07-01", "10.35:00", 1.21, 0.70,
  "2021-07-01", "10:50:00", 1.53, 0.63,
  "2021-07-01", "11:00:00", 2.83, 0.87,
  "2021-07-01", "11:20:00", 1.43, 0.39,
  "2021-07-01", "11:35:00", 1.63, 0.93,
  "2021-07-01", "11:45:00", 3.26, 0.90,
  "2021-07-01", "12:00:00", 3.39, 0.58,
  "2021-07-01", "12:15:00", 3.35, 1.13,
  "2021-07-01", "12:20:00", 3.34, 0.51,
  "2021-07-01", "12:35:00", 1.87, 1.20,
  "2021-07-01", "12:45:00", 3.66, 3.76,
  "2021-07-01", "12:55:00", 1.26, 0.60,
  "2021-07-01", "13:05:00", 2.80, 0.96,
  "2021-07-01", "13:15:00", 3.01, 0.95,
  "2021-07-01", "13:25:00", 1.22, 0.81,
  "2021-07-01", "13:35:00", 1.92, 0.82,
  "2021-07-01", "13:50:00", 1.39, 2.64,
  "2021-07-01", "14:00:00", 1.04, 2.60,
  "2021-07-01", "14:10:00", 1.15, 0.72,
  "2021-07-01", "14:20:00", 0.64, 0.67,
  "2021-07-01", "14:30:00", 3.64, 0.76,
  "2021-07-01", "14:40:00", 3.79, 0.76,
  "2021-07-01", "14:50:00", 0.90, 0.60,
  "2021-07-01", "15:00:00", 3.53, 2.96,
  "2021-07-01", "15:15:00", 3.31, 1.18,
  "2021-07-01", "15:25:00", 3.26, 0.88,
  "2021-07-01", "15:35:00", 1.15, 1.98,
  "2021-07-01", "15:45:00", 1.44, 2.02,
  "2021-07-01", "15:55:00", 3.19, 1.94,
  "2021-07-01", "16:05:00", 2.95, 2.21,
  "2021-07-01", "16:15:00", 1.54, 2.72,
  "2021-07-01", "16:25:00", 1.21, 2.01,
  "2021-07-01", "16:35:00", 1.10, 0.77,
  "2021-07-01", "16:50:00", 2.82, 2.29,
  "2021-07-01", "17:00:00", 2.86, 3.83,
  "2021-07-01", "17:10:00", 2.56, 3.46,
  "2021-07-01", "17:20:00", 2.38, 0.59,
  "2021-07-01", "17:25:00", 1.24, 0.68,
  "2021-07-01", "17:35:00", 2.61, 0.70,
  "2021-07-01", "17:40:00", 2.24, 1.08,
  "2021-07-01", "17:55:00", 1.87, 0.71,
  "2021-07-01", "18:05:00", 0.79, 9.92,
  "2021-07-01", "18:10:00", 0.64, 9.96,
  "2021-07-01", "18:20:00", 0.54, 1.50,
  "2021-07-01", "18:40:00", 0.62, 1.41,
  "2021-07-01", "19:00:00", 0.53, 1.52,
  "2021-07-01", "19:20:00", 0.22, 1.22,
  "2021-07-01", "19:45:00", 0.16, 0.92,
  "2021-07-01", "20:05:00", 0.20, 0.73,
  "2021-07-01", "20:25:00", 0.12, 0.58,
  "2021-07-01", "20:45:00", 0.04, 0.71,
) %>%
  mutate(solar_date = as.Date(solar_date),
         solar_datetime = lubridate::ymd_hms(paste(solar_date, solar_time), tz = "Europe/Dublin"))
